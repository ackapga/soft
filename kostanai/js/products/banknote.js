const data = [{
    link: "dors_1015.php",
    title: "Счетчики банкнот DORS CT1015",
    desc: "Весы предназначены для измерений массы различных грузов при торговых, учетных и технологических операциях. Легко интегрируются с учетными системами, POS-системами и смарт-терминалами. Позволяют работать в счетном и дозаторном режиме, режимах процентного взвешивания и контроля массы (компараторный режим).",
    price: "30988",
    img: "../images/schetchiki/11.jpg",
    display: "led",
    speed: 600,
    detection: ["optic"],
    series: "dors",
}, {
    link: "dors_1040.php",
    title: "Счетчики банкнот жидкокристаллические DORS CT1040",
    desc: "Cчетчики банкнот DORS CT1040 Series позволяют пересчитывать банкноты различных валют. Рекомендуются для пересчета однородной по номиналу денежной массы в местах с небольшим и средним оборотом наличных средств.",
    price: "53582",
    img: "../images/schetchiki/2.png",
    display: "crystal",
    speed: 1000,
    detection: ["optic", "uf", "geometry"],
    series: "dors",
}, {
    link: "dors_600.php",
    title: "Счетчики банкнот светодиодные DORS 600 М2",
    desc: "Счетчик банкнот DORS 600М2 обладает повышенной надежностью и большим ресурсом работы и рекомендуется для пересчета однородной по номиналу денежной массы в местах с большим оборотом наличных средств.",
    price: "106907",
    img: "../images/schetchiki/3.png",
    display: "led",
    speed: 1200,
    detection: ["optic"],
    series: "dors",
}, {
    link: "magner_35.php",
    title: "Счетчики банкнот светодиодные Magner 35S",
    desc: "Отсутствие широкого набора дополнительных функций обеспечивает счетчику банкнот Magner 35 S невысокую стоимость, сочетающуюся с отличными техническими характеристиками прибора.",
    price: "246239",
    img: "../images/schetchiki/6.jpg",
    display: "led",
    speed: 1300,
    detection: ["geometry", "optic"],
    series: "magner",
}, {
    link: "magner_2003.php",
    title: "Счетчики банкнот жидкокристаллические Magner 35-2003",
    desc: "Magner 35-2003 с обновленным дизайном и увеличенным приёмным карманом является продолжателем серии простых и надежных приборов Magner 35, предназначенных для пересчёта банкнот разной степени изношенности.",
    price: "209536",
    img: "../images/schetchiki/7.jpg",
    display: "crystal",
    speed: 1500,
    detection: ["geometry", "optic"],
    series: "magner",
}, {
    link: "magner_75.php",
    title: "Счетчики банкнот жидкокристаллические Magner 75 D",
    desc: "Счетчик банкнот Magner 75 D — высококачественный и надежный мультивалютный счетчик, предназначенный для быстрого пересчета банкнот с проверкой на подлинность по размеру купюры.",
    price: "301716",
    img: "../images/schetchiki/8.png",
    display: "crystal",
    speed: 1500,
    detection: ["geometry"],
    series: "magner",
}, {
    link: "dors_750.php",
    title: "Счетчики монохромные жидкокристаллические DORS 750",
    desc: "Dors 750 — это счетчик банкнот, оснащенный системой автоматического определения типа валюты, номинала и надежным блоком детекции подлинности. Высокая скорость счета, безотказность и емкие карманы обеспечивают Dors 750 производительностью.",
    price: "351107",
    img: "../images/schetchiki/4.jpg",
    display: "crystal",
    speed: 1500,
    detection: ["optic", "uf", "geometry", "ik"],
    series: "dors",
}, {
    link: "dors_800.php",
    title: "Счетчики банкнот цветные сенсорные DORS 800",
    desc: "Двухкарманный мультивалютный счетчик банкнот банковского класса DORS 800 Multi с определением номинала, детекцией по 9 признакам и функцией сортировки, гарантирует Вам быстрое решение любой задачи по обработке наличности.",
    price: "432632",
    img: "../images/schetchiki/5.jpg",
    display: "crystal",
    speed: 1500,
    detection: ["optic", "uf", "geometry", "ik", "magnit"],
    series: "dors",
}, {
    link: "magner_100.php",
    title: "Счетчики банкнот графические Magner 100",
    desc: "Интеллектуальный мультивалютный счётчик банкнот Magner 100 Digital предназначен для пересчёта и проверки подлинности тенге, долларов и евро с определением номинала и ориентации.",
    price: "708158",
    img: "../images/schetchiki/9.png",
    display: "crystal",
    speed: 1100,
    detection: ["uf", "geometry", "ik", "magnit", "optic"],
    series: "magner",
}, {
    link: "magner_150.php",
    title: "Счетчики банкнот графические Magner 150",
    desc: "Профессиональный двухкарманный счетчик банкнот Magner 150 Digital — самая популярная модель среди устройств своего уровня. Аппарат обеспечивает надежные пересчет, сортировку и детекцию на подлинность тенге, долларов США и евро.",
    price: "767000",
    img: "../images/schetchiki/10.jpg",
    display: "crystal",
    speed: 1500,
    detection: ["optic", "uf", "geometry", "ik", "magnit"],
    series: "magner",
}, {
    link: "magner_175.php",
    title: "Счетчики банкнот жидкокристаллические Magner 175",
    desc: "Мультивалютный двухкарманный сортировщик банкнот Magner 175F с функцией сортировки по ветхости предназначен для работы с любым объемом наличности. Предусмотрен режим раздельного учета операций для двух кассиров. Возможно расширение до 10 валют.",
    price: "1235000",
    img: "../images/schetchiki/20.png",
    display: "crystal",
    speed: 1500,
    detection: ["optic", "uf", "geometry", "ik", "magnit", "doubled"],
    series: "magner",
}]



const counters = document.getElementById('counters');

const priceSort = document.getElementById('priceSort');



let priceSortedArray = data.sort(function(a, b) {
    let x = a.price;
    let y = b.price;

    return x - y;
});
let initialArray = priceSortedArray;

let initStage = true;

priceSort.addEventListener("change", function() {
    if (priceSort.value == "first") {
        priceSortedArray = data.sort(function(a, b) {
            let x = a.price;
            let y = b.price;

            return x - y;
        });

    } else if (priceSort.value == "second") {
        priceSortedArray = data.sort(function(a, b) {
            let x = a.price;
            let y = b.price;

            return y - x;
        });
    }

    initialArray = priceSortedArray;
    filterArray();
});



function displayList(array) {
    counters.innerHTML = "";
    let video = document.createElement('div');
    // <p>Звоните прямо сейчас: <br><a href="tel:87015112200">8(727)<span> 344-99-00</span></a>; <a href="tel:+77012667700"><b>+7 701 266-77-00</b></a></p>
    video.innerHTML = `
            <div class="video1"><iframe width="780" height="439" src="https://www.youtube.com/embed/jpDM-Ybi5DE?rel=0&autoplay=0" frameborder="0" allow="accelerometer; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
            `;

    array.map((a) => {
        let item = document.createElement('div');
        item.classList.add("main");
        var formatter = function(priceSum) {
            let mn = 0;
            let price = priceSum.toString()
            for (let ij = price.length; ij > 0; ij--) {
                if (mn % 3 == 0) {
                    // price.splice(ij, 0, " ")
                    price = [price.slice(0, ij), " ", price.slice(ij)].join('');
                }
                mn++;
            }
            return price;
        }


        item.innerHTML = `
        <a href="${a.link}">
            <div class="col-md-3">
                <img src="${a.img}">
            </div>
            <div class="col-md-7">
                <div class="nazvanie">
                    <p>${a.title}</p>
                </div>
                <p>${a.desc}</p>
            </div>
            <div class="col-md-2">
                <p><span class="item-price-indicator_second">Цена:<br> </span><span class="item_price_second">${formatter(a.price)} тг </span></p>
                <a class="hvr-outline-out button2" href="${a.link}">Перейти</a>
            </div>
        </a>
    `;
        counters.appendChild(item);

    })
}

function showInitialStage() {
    displayList(initialArray);
    let params = countParam(initialArray);
    showParamCounters(params)
}


showInitialStage();

let filterParam = {
    display: [],
    detection: [],
    series: [],
    speed: [],
}

// filterArray()

function filterArray() {
    let updatedArray = initialArray.filter(function(a) {
            if (filterParam.display.length !== 0) {
                for (let i = 0; i < filterParam.display.length; i++) {
                    if (a.display === filterParam.display[i]) {
                        return a;
                    }
                }
            } else {
                return a;
            }
        })
        .filter(function(a) {
            if (filterParam.detection.length !== 0) {
                for (let i = 0; i < filterParam.detection.length; i++) {
                    for (let j = 0; j < a.detection.length; j++) {
                        if (a.detection[j] === filterParam.detection[i]) {
                            return a;
                        }
                    }
                }
            } else {
                return a;
            }
        })
        .filter(function(a) {
            if (filterParam.series.length !== 0) {
                for (let i = 0; i < filterParam.series.length; i++) {
                    if (a.series === filterParam.series[i]) {
                        return a;
                    }
                }
            } else {
                return a;
            }
        })
        .filter(function(a) {
            if (filterParam.speed.length !== 0) {
                for (let i = 0; i < filterParam.speed.length; i++) {
                    if (a.speed === filterParam.speed[i]) {
                        return a;
                    }
                }
            } else {
                return a;
            }
        })

    let params = countParam(updatedArray);
    showParamCounters(params)



    console.log(updatedArray);
    console.log(filterParam);
    if (updatedArray.length !== 0) {
        displayList(updatedArray)
        addFilterOption(filterOptionArray)
    } else {
        // if (clickArr.length > 0) {
        clickArr[clickArr.length - 1].checked = false;
        clickArr.pop()
        filterOptionArray.pop()
        errorMsg()
        updateFilterParam()
            // }
    }
}


let clickArr = []
let filterOptionArray = []
let btnArray = []

const c1b1Btn = document.getElementById('c1b1');
const c1b2Btn = document.getElementById('c1b2');
const c2b1Btn = document.getElementById('c2b1');
const c2b2Btn = document.getElementById('c2b2');
const c2b3Btn = document.getElementById('c2b3');
const c2b4Btn = document.getElementById('c2b4');
const c2b5Btn = document.getElementById('c2b5');
const c3b1Btn = document.getElementById('c3b1');
const c3b2Btn = document.getElementById('c3b2');
const c4b1Btn = document.getElementById('c4b1');
const c4b2Btn = document.getElementById('c4b2');
const c4b3Btn = document.getElementById('c4b3');
const c4b4Btn = document.getElementById('c4b4');
const c4b5Btn = document.getElementById('c4b5');




function updateFilterParam() {
    filterParam.display = [];

    if (c1b1Btn.checked) {
        filterParam.display.push("led");
    }

    if (c1b2Btn.checked) {
        filterParam.display.push("crystal");
    }

    filterParam.detection = [];

    if (c2b1Btn.checked) {
        filterParam.detection.push("geometry");
    }

    if (c2b2Btn.checked) {
        filterParam.detection.push("uf");
    }

    if (c2b3Btn.checked) {
        filterParam.detection.push("ik");
    }

    if (c2b4Btn.checked) {
        filterParam.detection.push("optic");
    }

    if (c2b5Btn.checked) {
        filterParam.detection.push("magnit");
    }


    filterParam.series = [];

    if (c3b1Btn.checked) {
        filterParam.series.push("dors");
    }

    if (c3b2Btn.checked) {
        filterParam.series.push("magner");
    }

    filterParam.speed = [];

    if (c4b1Btn.checked) {
        filterParam.speed.push(600);
    }

    if (c4b2Btn.checked) {
        filterParam.speed.push(1100);
    }

    if (c4b3Btn.checked) {
        filterParam.speed.push(1200);
    }

    if (c4b4Btn.checked) {
        filterParam.speed.push(1300);
    }

    if (c4b5Btn.checked) {
        filterParam.speed.push(1500);
    }


    filterArray()
}

function spliceMethod(value) {
    const idx = clickArr.indexOf(value);
    if (idx > -1) {
        clickArr.splice(idx, 1);
    }
}

function spliceMethodSecond(value) {
    const idx = filterOptionArray.indexOf(value);
    if (idx > -1) {
        filterOptionArray.splice(idx, 1);
    }
}


function c1b1BtnClick() {
    if (c1b1Btn.checked == true) {
        filterOptionArray.push('Жидкокристаллический')
        clickArr.push(c1b1Btn)
        arrCounter = true;
    } else {
        spliceMethod(c1b1Btn);
        spliceMethodSecond('Жидкокристаллический')
        arrCounter = false;
    }
    updateFilterParam()
}

function c1b2BtnClick() {
    if (c1b2Btn.checked == true) {
        filterOptionArray.push('Светодиодный')
        clickArr.push(c1b2Btn)
        arrCounter = true;
    } else {
        spliceMethod(c1b2Btn);
        spliceMethodSecond('Светодиодный')
        arrCounter = false;
    }
    updateFilterParam()
}


function c2b1BtnClick() {
    if (c2b1Btn.checked == true) {
        filterOptionArray.push('по геометрическим параметрам ')
        clickArr.push(c2b1Btn)
        arrCounter = true;
    } else {
        spliceMethod(c2b1Btn);
        spliceMethodSecond('по геометрическим параметрам ')
        arrCounter = false;
    }
    updateFilterParam()
}

function c2b2BtnClick() {
    if (c2b2Btn.checked == true) {
        filterOptionArray.push('в ультрафиолетовом излучении')
        clickArr.push(c2b2Btn)
        arrCounter = true;
    } else {
        spliceMethod(c2b2Btn);
        spliceMethodSecond('в ультрафиолетовом излучении')
        arrCounter = false;
    }
    updateFilterParam()
}

function c2b3BtnClick() {
    if (c2b3Btn.checked == true) {
        filterOptionArray.push('инфракрасная защита')
        clickArr.push(c2b3Btn)
        arrCounter = true;
    } else {
        spliceMethod(c2b3Btn);
        spliceMethodSecond('инфракрасная защита')
        arrCounter = false;
    }
    updateFilterParam()
}

function c2b4BtnClick() {
    if (c2b4Btn.checked == true) {
        filterOptionArray.push('по оптической плотности')
        clickArr.push(c2b4Btn)
        arrCounter = true;
    } else {
        spliceMethod(c2b4Btn);
        spliceMethodSecond('по оптической плотности')
        arrCounter = false;
    }

    updateFilterParam()
}

function c2b5BtnClick() {
    if (c2b5Btn.checked == true) {
        filterOptionArray.push('по магнитным меткам')
        clickArr.push(c2b5Btn)
        arrCounter = true;
    } else {
        spliceMethod(c2b5Btn);
        spliceMethodSecond('по магнитным меткам')
        arrCounter = false;
    }

    updateFilterParam()
}

function c3b1BtnClick() {
    if (c3b1Btn.checked == true) {
        filterOptionArray.push('Dors')
        clickArr.push(c3b1Btn)
        arrCounter = true;
    } else {
        spliceMethod(c3b1Btn);
        spliceMethodSecond('Dors')
        arrCounter = false;
    }
    updateFilterParam()
}

function c3b2BtnClick() {
    if (c3b2Btn.checked == true) {
        filterOptionArray.push('Magner')
        clickArr.push(c3b2Btn)
        arrCounter = true;
    } else {
        spliceMethod(c3b2Btn);
        spliceMethodSecond('Magner')
        arrCounter = false;
    }
    updateFilterParam()
}

function c4b1BtnClick() {
    if (c4b1Btn.checked == true) {
        filterOptionArray.push('600 банкнот/мин')
        clickArr.push(c4b1Btn)
        arrCounter = true;
    } else {
        spliceMethod(c4b1Btn);
        spliceMethodSecond('600 банкнот/мин')
        arrCounter = false;
    }
    updateFilterParam()
}

function c4b2BtnClick() {
    if (c4b2Btn.checked == true) {
        filterOptionArray.push('1100 банкнот/мин')
        clickArr.push(c4b2Btn)
        arrCounter = true;
    } else {
        spliceMethod(c4b2Btn);
        spliceMethodSecond('1100 банкнот/мин')
        arrCounter = false;
    }
    updateFilterParam()
}

function c4b3BtnClick() {
    if (c4b3Btn.checked == true) {
        filterOptionArray.push('1200 банкнот/мин')
        clickArr.push(c4b3Btn)
        arrCounter = true;
    } else {
        spliceMethod(c4b3Btn);
        spliceMethodSecond('1200 банкнот/мин')
        arrCounter = false;
    }
    updateFilterParam()
}

function c4b4BtnClick() {
    if (c4b4Btn.checked == true) {
        filterOptionArray.push('1300 банкнот/мин')
        clickArr.push(c4b4Btn)
        arrCounter = true;
    } else {
        spliceMethod(c4b4Btn);
        spliceMethodSecond('1300 банкнот/мин')
        arrCounter = false;
    }

    updateFilterParam()
}

function c4b5BtnClick() {
    if (c4b5Btn.checked == true) {
        filterOptionArray.push('1500 банкнот/мин')
        clickArr.push(c4b5Btn)
        arrCounter = true;
    } else {
        spliceMethod(c4b5Btn);
        spliceMethodSecond('1500 банкнот/мин')
        arrCounter = false;
    }

    updateFilterParam()
}


c1b1Btn.addEventListener('click', c1b1BtnClick)
c1b2Btn.addEventListener('click', c1b2BtnClick)
c2b1Btn.addEventListener('click', c2b1BtnClick)
c2b2Btn.addEventListener('click', c2b2BtnClick)
c2b3Btn.addEventListener('click', c2b3BtnClick)
c2b4Btn.addEventListener('click', c2b4BtnClick)
c2b5Btn.addEventListener('click', c2b5BtnClick)
c3b1Btn.addEventListener('click', c3b1BtnClick)
c3b2Btn.addEventListener('click', c3b2BtnClick)
c4b1Btn.addEventListener('click', c4b1BtnClick)
c4b2Btn.addEventListener('click', c4b2BtnClick)
c4b3Btn.addEventListener('click', c4b3BtnClick)
c4b4Btn.addEventListener('click', c4b4BtnClick)
c4b5Btn.addEventListener('click', c4b5BtnClick)



let checkBoxArr = []
    // settings関数で初期設定 全体に適応させたい場合
iziToast.settings({
    timeout: 3000, // default timeout
    resetOnHover: true,
    // icon: '', // icon class
    transitionIn: 'flipInX',
    transitionOut: 'flipOutX',
    position: 'topRight', // bottomRight, bottomLeft, topRight, topLeft, topCenter, bottomCenter, center
    onOpen: function() {
        // console.log('callback abriu!');
    },
    onClose: function() {
        // console.log("callback fechou!");
    }
});


// error
function errorMsg() {
    iziToast.warning({ title: '', message: 'По таким параметрам продуктов не найдено' });
}


const filter = document.getElementById("filter");
let arrCounter = true;

function addFilterOption(arr) {
    let index = 0;
    filter.innerHTML = "";
    arr.map(a => {
        let filterOption = document.createElement('div');
        filterOption.setAttribute("data-id", index)
        filterOption.id = "filterOption"
        filterOption.classList.add('filter-option')
        if (arrCounter == true) {
            filterOption.classList.add('filter-animation')
        }
        if (index > 0) {
            document.querySelector(`[data-id="${index - 1}"]`).classList.remove('filter-animation');
        }
        filterOption.innerHTML = `
        <span class="filter-option-value" data-id="${index}">${a} 
            <svg xmlns="https://www.w3.org/2000/svg" style="
            pointer-events: none;
            margin-left: 8.5px;" data-id="${index} width="10px" height="10px" viewBox="0 0 7 7" id="filterOptionSvg" fill="none">
                <path data-id="${index} id="filterOptionPath" fill-rule="evenodd" clip-rule="evenodd" d="M4.00199 4.7091L6.64844 7.35554L7.35554 6.64844L4.7091 4.00199L7.35554 1.35554L6.64844 0.648438L4.00199 3.29488L1.35554 0.648438L0.648438 1.35554L3.29488 4.00199L0.648438 6.64844L1.35554 7.35554L4.00199 4.7091Z" fill="#C4C4C4"></path>
            </svg>
        </span>
        `;
        filter.appendChild(filterOption);
        index++;
    })
}

let filterOption = document.querySelector(".filter-option");

document.addEventListener(
    "click",
    function(e) {
        e = e || window.event;
        let target = e.srcElement;
        if (
            target.id === "filterOption" ||
            target.parentNode.id === "filterOption"
        ) {
            arrCounter = false;
            // console.log(filterOptionArray);
            let selectedId = parseInt(target.getAttribute('data-id'), 10);
            removeFilterElement(selectedId)
                // console.log(filterOptionArray);

        }
    },
    false
);



function removeFilterElement(value) {
    filterOptionArray.splice(value, 1);
    clickArr[value].checked = false;
    clickArr.splice(value, 1)
    updateFilterParam();
}

function countParam(array) {
    let display1 = 0;
    let display2 = 0;
    let detection1 = 0;
    let detection2 = 0;
    let detection3 = 0;
    let detection4 = 0;
    let detection5 = 0;
    let series1 = 0;
    let series2 = 0;
    let speed1 = 0;
    let speed2 = 0;
    let speed3 = 0;
    let speed4 = 0;
    let speed5 = 0;



    for (let index = 0; index < array.length; index++) {
        if (array[index].display == "led") {
            display1++;
        } else if (array[index].display == "crystal") {
            display2++;
        }


        for (let i = 0; i < array[index].detection.length; i++) {
            if (array[index].detection[i] == "geometry") {
                detection1++;
            } else if (array[index].detection[i] == "uf") {
                detection2++;
            } else if (array[index].detection[i] == "ik") {
                detection3++;
            } else if (array[index].detection[i] == "optic") {
                detection4++;
            } else if (array[index].detection[i] == "magnit") {
                detection5++;
            }
        }


        if (array[index].series == "dors") {
            series1++;
        } else if (array[index].series == "magner") {
            series2++;
        }

        if (array[index].speed == 600) {
            speed1++;
        } else if (array[index].speed == 1100) {
            speed2++;
        } else if (array[index].speed == 1200) {
            speed3++;
        } else if (array[index].speed == 1300) {
            speed4++;
        } else if (array[index].speed == 1500) {
            speed5++;
        }
    }

    return [display1, display2, detection1, detection2, detection3, detection4, detection5, series1, series2, speed1, speed2, speed3, speed4, speed5]

}

function showParamCounters(array) {
    for (let index = 0; index < array.length; index++) {
        document.getElementById(`${index+1}param`).innerHTML = array[index]
    }
}